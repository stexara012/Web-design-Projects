<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Neon Music Player</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* =========================================
   ANIMATED NEON GRID BACKGROUND
========================================= */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  background: #000;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;

  background:
    linear-gradient(rgba(0,255,240,0.15) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,240,0.15) 1px, transparent 1px),
    radial-gradient(circle at center, #111 0%, #000 85%);

  background-size:
    45px 45px,
    45px 45px,
    100% 100%;

  animation: gridMove 10s linear infinite;
  filter: drop-shadow(0 0 3px #00fff0);
}

@keyframes gridMove {
  0% { background-position: 0 0, 0 0, 0 0; }
  100% { background-position: 0 45px, 45px 0, 0 0; }
}

/* =========================================
   PLAYER BOX (RGB Glow)
========================================= */
.player-box {
  width: 760px;
  padding: 25px;
  border-radius: 20px;
  border: 3px solid #00fff0;
  background: rgba(0,0,0,0.55);
  animation: glowRGB 6s infinite linear;
}

@keyframes glowRGB {
  0% { box-shadow: 0 0 25px #00fff0; border-color:#00fff0; }
  33% { box-shadow: 0 0 30px #ff00ff; border-color:#ff00ff; }
  66% { box-shadow: 0 0 30px #00b3ff; border-color:#00b3ff; }
  100% { box-shadow: 0 0 25px #00fff0; border-color:#00fff0; }
}

/* =========================================
   PERFECT ROUND BUTTONS + RIPPLE EXPLOSION
========================================= */
.controls {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 15px;
  margin: 20px 0;
}

.btn {
  background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
  border: none;

  /* PERFECT CIRCLE */
  width: 65px;
  height: 65px;
  border-radius: 50%;

  display: flex;
  justify-content: center;
  align-items: center;

  color: white;
  font-size: 22px;
  cursor: pointer;

  position: relative;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}

.btn:hover { transform: scale(1.1); }

/* Ripple explosion */
.btn:active::after {
  content: "";
  position: absolute;
  width: 200px;
  height: 200px;
  background: rgba(0,255,240,0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  animation: ripple 0.6s ease-out;
  left: 50%;
  top: 50%;
}

@keyframes ripple {
  to {
    transform: translate(-50%, -50%) scale(3);
    opacity: 0;
  }
}

/* =========================================
   PROGRESS BAR
========================================= */
.progress-container {
  height: 10px;
  width: 100%;
  background: #222;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 12px;
}
.progress { height: 100%; width: 0%; background: #00fff0; }

/* =========================================
   PLAYLIST
========================================= */
.playlist {
  margin-top: 15px;
  max-height: 200px;
  overflow-y: auto;
  border: 2px solid #00fff0;
  padding: 10px;
  border-radius: 10px;
}

.playlist div {
  padding: 10px;
  cursor: pointer;
  margin-bottom: 5px;
  background: rgba(255,255,255,0.05);
  border-radius: 5px;
  transition: 0.2s;
}

.playlist div:hover { background: rgba(0,255,240,0.2); }
.playlist .active-track { background: rgba(0,255,240,0.4); }

/* =========================================
   EQUALIZER CANVAS
========================================= */
canvas {
  width: 100%;
  height: 130px;
  background: #111;
  margin-top: 20px;
  border-radius: 10px;
}
</style>
</head>
<body>

<div class="player-box">

  <input type="file" id="audio-upload" accept="audio/*" multiple>

  <div class="controls">
    <button class="btn" id="play"><i class="fas fa-play"></i></button>
    <button class="btn" id="pause"><i class="fas fa-pause"></i></button>
    <button class="btn" id="stop"><i class="fas fa-stop"></i></button>
    <button class="btn" id="rewind"><i class="fas fa-backward"></i></button>
    <button class="btn" id="forward"><i class="fas fa-forward"></i></button>

    <button class="btn" id="shuffle"><i class="fas fa-random"></i></button>
    <button class="btn" id="repeat"><i class="fas fa-redo"></i></button>
    <button class="btn" id="mute"><i class="fas fa-volume-mute"></i></button>
    <button class="btn" id="vol-min"><i class="fas fa-volume-off"></i></button>
    <button class="btn" id="vol-max"><i class="fas fa-volume-up"></i></button>
  </div>

  <div class="progress-container">
    <div class="progress" id="progress"></div>
  </div>

  <div class="time" id="time">0:00 / 0:00</div>

  <div class="playlist" id="playlist"></div>

  <canvas id="equalizer"></canvas>

</div>

<script>
let audio = new Audio();
let playlist = [];
let currentIndex = 0;

let audioContext, source, analyser, dataArray;

const bg = document.body;
const listBox = document.getElementById("playlist");
const upload = document.getElementById("audio-upload");
const progressBar = document.getElementById("progress");
const timeDisplay = document.getElementById("time");
const canvas = document.getElementById("equalizer");
const ctx = canvas.getContext("2d");

/* LOAD MULTIPLE SONGS */
upload.addEventListener("change", (e) => {
  playlist = [...e.target.files];
  renderPlaylist();
  loadTrack(0);
});

/* RENDER PLAYLIST */
function renderPlaylist() {
  listBox.innerHTML = "";
  playlist.forEach((file, i) => {
    const div = document.createElement("div");
    div.textContent = file.name;
    div.onclick = () => loadTrack(i);
    if (i === currentIndex) div.classList.add("active-track");
    listBox.appendChild(div);
  });
}

/* LOAD & PLAY TRACK (with Fade-in) */
function loadTrack(i) {
  currentIndex = i;
  renderPlaylist();

  const file = playlist[i];
  if (!file) return;

  audio.volume = 0;
  audio.src = URL.createObjectURL(file);
  audio.play();

  let v = 0;
  const fade = setInterval(() => {
    v += 0.03;
    audio.volume = Math.min(1, v);
    if (v >= 1) clearInterval(fade);
  }, 40);

  setupAudioContext();
}

/* Auto next */
audio.onended = () => {
  if (audio.loop) return;
  currentIndex = (currentIndex + 1) % playlist.length;
  loadTrack(currentIndex);
};

/* AUDIO CONTEXT + EQUALIZER */
function setupAudioContext() {
  if (audioContext) audioContext.close();
  audioContext = new AudioContext();

  source = audioContext.createMediaElementSource(audio);
  analyser = audioContext.createAnalyser();
  analyser.fftSize = 256;

  dataArray = new Uint8Array(analyser.frequencyBinCount);

  source.connect(analyser);
  analyser.connect(audioContext.destination);

  drawEQ();
}

/* EQUALIZER (Wavy + Pulse) */
function drawEQ() {
  requestAnimationFrame(drawEQ);
  analyser.getByteFrequencyData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const barWidth = (canvas.width / dataArray.length) * 2.5;
  let x = 0;

  const t = Date.now() * 0.004;
  let peak = false;

  for (let i = 0; i < dataArray.length; i++) {
    let h = dataArray[i];
    let wave = Math.sin(i * 0.15 + t) * 25;

    if (h > 200) peak = true;

    ctx.fillStyle = `hsl(${h + wave}, 80%, 60%)`;
    ctx.fillRect(x, canvas.height - (h + wave), barWidth, h + wave);
    x += barWidth + 1;
  }

  /* Background flashes on peaks */
  if (peak) {
    bg.style.background = "radial-gradient(circle, #330033 0%, #000 100%)";
    setTimeout(() => {
      bg.style.background = "#000";
    }, 150);
  }
}

/* CONTROLS */
document.getElementById("play").onclick = () => { audio.play(); audioContext.resume(); };
document.getElementById("pause").onclick = () => audio.pause();
document.getElementById("stop").onclick = () => { audio.pause(); audio.currentTime = 0; };
document.getElementById("rewind").onclick = () => audio.currentTime = Math.max(0, audio.currentTime - 5);
document.getElementById("forward").onclick = () => audio.currentTime = Math.min(audio.duration, audio.currentTime + 5);

document.getElementById("shuffle").onclick = () => loadTrack(Math.floor(Math.random() * playlist.length));
document.getElementById("repeat").onclick = () => audio.loop = !audio.loop;
document.getElementById("mute").onclick = () => audio.muted = !audio.muted;

document.getElementById("vol-min").onclick = () => audio.volume = 0;
document.getElementById("vol-max").onclick = () => audio.volume = 1;

/* PROGRESS BAR */
audio.addEventListener("timeupdate", () => {
  if (!audio.duration) return;

  progressBar.style.width = (audio.currentTime / audio.duration * 100) + "%";
  timeDisplay.textContent = format(audio.currentTime) + " / " + format(audio.duration);
});

function format(s) {
  let m = Math.floor(s / 60);
  let sec = Math.floor(s % 60).toString().padStart(2,"0");
  return `${m}:${sec}`;
}
</script>

</body>
</html>
