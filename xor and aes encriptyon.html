<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>XOR + AES Encryption Tool</title>
<style>
    body {
        margin: 0;
        background: #0d0d0d;
        color: #e6e6e6;
        font-family: "Segoe UI", Consolas, sans-serif;
        transition: 0.3s;
    }

    body.light {
        background: #f5f5f5;
        color: #111;
    }

    .container {
        max-width: 900px;
        margin: 30px auto;
        padding: 25px;
        background: #161616;
        border-radius: 10px;
        box-shadow: 0 0 15px #000;
        border: 1px solid #222;
        transition: 0.3s;
    }

    body.light .container {
        background: #fff;
        border-color: #ddd;
        box-shadow: 0 0 10px #ccc;
    }

    h1 {
        text-align: center;
        color: #4aa3ff;
        margin-bottom: 10px;
        text-shadow: 0 0 10px #003366;
    }

    h2 {
        margin-top: 35px;
        color: #4aa3ff;
    }

    label {
        font-weight: bold;
        font-size: 17px;
    }

    textarea, input {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        margin-bottom: 18px;
        background: #1e1e1e;
        color: #fff;
        border-radius: 6px;
        border: 1px solid #333;
        font-size: 15px;
    }

    body.light textarea, 
    body.light input {
        background: #fafafa;
        color: #000;
        border: 1px solid #ccc;
    }

    textarea {
        resize: vertical;
    }

    button {
        padding: 12px 18px;
        border: none;
        border-radius: 6px;
        background: #4aa3ff;
        color: #fff;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 15px;
        transition: 0.15s;
    }

    button:hover {
        transform: translateY(-2px);
        background: #347cd1;
    }

    .aes-section, .xor-section {
        border-left: 4px solid #4aa3ff;
        padding-left: 15px;
        margin-top: 30px;
    }

    .copy-btn {
        background: #00c96b;
    }
    .copy-btn:hover { background: #009e54; }

    .download-btn {
        background: #ffaa33;
    }
    .download-btn:hover { background: #d98c22; }

    #themeSwitch {
        background: #777;
        float: right;
    }
    #themeSwitch:hover {
        background: #666;
    }

    .info-box {
        background: #112233;
        padding: 10px;
        border-left: 4px solid #4aa3ff;
        margin-bottom: 20px;
        border-radius: 4px;
        color: #aacfff;
    }

    .warning {
        background: #331111;
        padding: 12px;
        border-left: 4px solid #cc4444;
        color: #ffaaaa;
        border-radius: 4px;
    }

    #toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #4aa3ff;
        padding: 12px 18px;
        border-radius: 6px;
        color: white;
        opacity: 0;
        pointer-events: none;
        transition: 0.3s;
    }
</style>
</head>
<body>

<button id="themeSwitch" onclick="toggleTheme()">Light/Dark</button>

<div class="container">

    <h1>üîê XOR + AES Encryption Tool</h1>

    <div class="info-box">
        AES-256-GCM je profesionalni sigurnosni standard.  
        XOR je samo edukativni primer ‚Äì vrlo slab i lako razbijiv.
    </div>

    <!-- XOR SECTION -->
    <div class="xor-section">
        <h2>‚ùå XOR Encryption</h2>

        <label>Key:</label>
        <input type="text" id="xorKey">

        <label>Text:</label>
        <textarea id="xorInput" rows="5"></textarea>

        <button onclick="xorEncrypt()">XOR Encrypt (Base64)</button>
        <button onclick="xorDecrypt()">XOR Decrypt (Base64)</button>
        <button class="copy-btn" onclick="copyResult('xorOutput')">Copy</button>
        <button class="download-btn" onclick="downloadText('xorOutput')">Download</button>

        <label>Result:</label>
        <textarea id="xorOutput" rows="5" readonly></textarea>

        <div class="warning">
            ‚ö† XOR enkripcija je vrlo slaba ‚Äî koristi je samo za uƒçenje, nikad za realnu za≈°titu.
        </div>
    </div>


    <!-- AES SECTION -->
    <div class="aes-section">
        <h2>üõ° AES-256-GCM Encryption</h2>

        <label>Password:</label>
        <input type="text" id="aesPassword">

        <label>Text:</label>
        <textarea id="aesInput" rows="5"></textarea>

        <button onclick="aesEncrypt()">AES Encrypt</button>
        <button onclick="aesDecrypt()">AES Decrypt</button>
        <button class="copy-btn" onclick="copyResult('aesOutput')">Copy</button>
        <button class="download-btn" onclick="downloadText('aesOutput')">Download</button>

        <label>Result:</label>
        <textarea id="aesOutput" rows="5" readonly></textarea>
    </div>

</div>

<div id="toast"></div>

<script>
/* --------------------- UI TOOLS ---------------------- */
function toast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.style.opacity = 1;
    setTimeout(() => { t.style.opacity = 0; }, 2000);
}

function copyResult(id) {
    const el = document.getElementById(id);
    el.select();
    document.execCommand("copy");
    toast("Copied!");
}

function downloadText(id) {
    const text = document.getElementById(id).value;
    const blob = new Blob([text], {type: "text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = id + ".txt";
    a.click();
    toast("Downloaded!");
}

function toggleTheme() {
    document.body.classList.toggle("light");
}

/* --------------------- XOR ---------------------- */
function xorEncrypt() {
    try {
        const key = new TextEncoder().encode(document.getElementById("xorKey").value);
        const text = new TextEncoder().encode(document.getElementById("xorInput").value);

        const out = new Uint8Array(text.length);
        for (let i = 0; i < text.length; i++)
            out[i] = text[i] ^ key[i % key.length];

        const base64 = btoa(String.fromCharCode(...out));
        document.getElementById("xorOutput").value = base64;
        toast("XOR encrypted!");
    } catch (e) { alert(e); }
}

function xorDecrypt() {
    try {
        const key = new TextEncoder().encode(document.getElementById("xorKey").value);
        const b64 = document.getElementById("xorInput").value;

        const bytes = new Uint8Array([...atob(b64)].map(c => c.charCodeAt(0)));

        const out = new Uint8Array(bytes.length);
        for (let i = 0; i < bytes.length; i++)
            out[i] = bytes[i] ^ key[i % key.length];

        const text = new TextDecoder().decode(out);
        document.getElementById("xorOutput").value = text;
        toast("XOR decrypted!");
    } catch (e) { alert("Invalid Base64 or wrong key."); }
}

/* --------------------- AES ---------------------- */

async function getAESKey(password) {
    const enc = new TextEncoder().encode(password);
    const keyMaterial = await crypto.subtle.importKey("raw", enc, "PBKDF2", false, ["deriveKey"]);

    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: new Uint8Array([1,2,3,4,5,6,7,8]),
            iterations: 100000,
            hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
    );
}

async function aesEncrypt() {
    try {
        const password = document.getElementById("aesPassword").value;
        const text = document.getElementById("aesInput").value;

        const iv = crypto.getRandomValues(new Uint8Array(12));
        const key = await getAESKey(password);

        const encrypted = await crypto.subtle.encrypt(
            { name: "AES-GCM", iv },
            key,
            new TextEncoder().encode(text)
        );

        const result = btoa(
            String.fromCharCode(...iv) +
            String.fromCharCode(...new Uint8Array(encrypted))
        );

        document.getElementById("aesOutput").value = result;
        toast("AES encrypted!");
    } catch (e) { alert(e); }
}

async function aesDecrypt() {
    try {
        const password = document.getElementById("aesPassword").value;
        const b64 = document.getElementById("aesInput").value;

        const bytes = new Uint8Array([...atob(b64)].map(c => c.charCodeAt(0)));

        const iv = bytes.slice(0, 12);
        const data = bytes.slice(12);

        const key = await getAESKey(password);

        const decrypted = await crypto.subtle.decrypt(
            { name: "AES-GCM", iv },
            key,
            data
        );

        document.getElementById("aesOutput").value =
            new TextDecoder().decode(decrypted);

        toast("AES decrypted!");
    } catch (e) {
        alert("Invalid password or corrupted data.");
    }
}
</script>

</body>
</html>
